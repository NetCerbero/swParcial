<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from www.dbdesigner.net/designer?login_guest=true by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Nov 2018 16:35:37 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="UTF-8">
  <title>Schema Designer | DB Designer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script>
  var _rollbarConfig = {
      accessToken: "7cae76bdce6d4737a5109edcddc6577e",
      ignoredMessages: ['(unknown): Script error.'],
      captureUncaught: true,
      payload: {
          environment: "production"
      }
};
// Rollbar Snippet
!function(r){function o(e){if(t[e])return t[e].exports;var n=t[e]={exports:{},id:e,loaded:!1};return r[e].call(n.exports,n,n.exports,o),n.loaded=!0,n.exports}var t={};return o.m=r,o.c=t,o.p="",o(0)}([function(r,o,t){"use strict";var e=t(1).Rollbar,n=t(2);_rollbarConfig.rollbarJsUrl=_rollbarConfig.rollbarJsUrl||"https://d37gvrvc0wt4s1.cloudfront.net/js/v1.8/rollbar.min.js";var a=e.init(window,_rollbarConfig),i=n(a,_rollbarConfig);a.loadFull(window,document,!_rollbarConfig.async,_rollbarConfig,i)},function(r,o){"use strict";function t(r){return function(){try{return r.apply(this,arguments)}catch(o){try{console.error("[Rollbar]: Internal error",o)}catch(t){}}}}function e(r,o,t){window._rollbarWrappedError&&(t[4]||(t[4]=window._rollbarWrappedError),t[5]||(t[5]=window._rollbarWrappedError._rollbarContext),window._rollbarWrappedError=null),r.uncaughtError.apply(r,t),o&&o.apply(window,t)}function n(r){var o=function(){var o=Array.prototype.slice.call(arguments,0);e(r,r._rollbarOldOnError,o)};return o.belongsToShim=!0,o}function a(r){this.shimId=++s,this.notifier=null,this.parentShim=r,this._rollbarOldOnError=null}function i(r){var o=a;return t(function(){if(this.notifier)return this.notifier[r].apply(this.notifier,arguments);var t=this,e="scope"===r;e&&(t=new o(this));var n=Array.prototype.slice.call(arguments,0),a={shim:t,method:r,args:n,ts:new Date};return window._rollbarShimQueue.push(a),e?t:void 0})}function l(r,o){if(o.hasOwnProperty&&o.hasOwnProperty("addEventListener")){var t=o.addEventListener;o.addEventListener=function(o,e,n){t.call(this,o,r.wrap(e),n)};var e=o.removeEventListener;o.removeEventListener=function(r,o,t){e.call(this,r,o&&o._wrapped?o._wrapped:o,t)}}}var s=0;a.init=function(r,o){var e=o.globalAlias||"Rollbar";if("object"==typeof r[e])return r[e];r._rollbarShimQueue=[],r._rollbarWrappedError=null,o=o||{};var i=new a;return t(function(){if(i.configure(o),o.captureUncaught){i._rollbarOldOnError=r.onerror,r.onerror=n(i);var t,a,s="EventTarget,Window,Node,ApplicationCache,AudioTrackList,ChannelMergerNode,CryptoOperation,EventSource,FileReader,HTMLUnknownElement,IDBDatabase,IDBRequest,IDBTransaction,KeyOperation,MediaController,MessagePort,ModalWindow,Notification,SVGElementInstance,Screen,TextTrack,TextTrackCue,TextTrackList,WebSocket,WebSocketWorker,Worker,XMLHttpRequest,XMLHttpRequestEventTarget,XMLHttpRequestUpload".split(",");for(t=0;t<s.length;++t)a=s[t],r[a]&&r[a].prototype&&l(i,r[a].prototype)}return r[e]=i,i})()},a.prototype.loadFull=function(r,o,e,n,a){var i=function(){var o;if(void 0===r._rollbarPayloadQueue){var t,e,n,i;for(o=new Error("rollbar.js did not load");t=r._rollbarShimQueue.shift();)for(n=t.args,i=0;i<n.length;++i)if(e=n[i],"function"==typeof e){e(o);break}}"function"==typeof a&&a(o)},l=!1,s=o.createElement("script"),u=o.getElementsByTagName("script")[0],p=u.parentNode;s.crossOrigin="",s.src=n.rollbarJsUrl,s.async=!e,s.onload=s.onreadystatechange=t(function(){if(!(l||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)){s.onload=s.onreadystatechange=null;try{p.removeChild(s)}catch(r){}l=!0,i()}}),p.insertBefore(s,u)},a.prototype.wrap=function(r,o){try{var t;if(t="function"==typeof o?o:function(){return o||{}},"function"!=typeof r)return r;if(r._isWrap)return r;if(!r._wrapped){r._wrapped=function(){try{return r.apply(this,arguments)}catch(o){throw o._rollbarContext=t()||{},o._rollbarContext._wrappedSource=r.toString(),window._rollbarWrappedError=o,o}},r._wrapped._isWrap=!0;for(var e in r)r.hasOwnProperty(e)&&(r._wrapped[e]=r[e])}return r._wrapped}catch(n){return r}};for(var u="log,debug,info,warn,warning,error,critical,global,configure,scope,uncaughtError".split(","),p=0;p<u.length;++p)a.prototype[u[p]]=i(u[p]);r.exports={Rollbar:a,_rollbarWindowOnError:e}},function(r,o){"use strict";r.exports=function(r,o){return function(t){if(!t&&!window._rollbarInitialized){var e=window.RollbarNotifier,n=o||{},a=n.globalAlias||"Rollbar",i=window.Rollbar.init(n,r);i._processShimQueue(window._rollbarShimQueue||[]),window[a]=i,window._rollbarInitialized=!0,e.processPayloads()}}}}]);
// End Rollbar Snippet
</script>
  <!--[if lt IE 9]>
  <script src="/excanvas.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" media="all" href="assets/application-eb96851b106371a3a4f85b0516295deff823392baf83697c9b56f8809448eab0.css" />
  <script src="assets/app.js"></script>
  <script src="jscolor/jscolor.js" type="text/javascript"></script>
  
  <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
  <script>
    var config = {
        apiKey: "AIzaSyB2Eiy3ZWFMbKdY__JjW_AVkPyuEDsAS3Q",
        authDomain: "swparcial.firebaseapp.com",
        databaseURL: "https://swparcial.firebaseio.com",
        projectId: "swparcial",
        storageBucket: "swparcial.appspot.com",
        messagingSenderId: "526134105713"
      };
    firebase.initializeApp(config);
  </script>
  <meta name="csrf-param" content="authenticity_token" />
  <meta name="csrf-token" content="CcM+OEUQR68T8BNyJi5ra0GPH20GcSFN+rDpT9Qrc60Vp/gBQvpObkFwFTLgQw6GXSvVJdCFK3s5OUD8wMinoQ==" />
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="favicon-196x196.png" sizes="196x196" />
  <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16" />
  <link rel="icon" type="image/png" href="favicon-128.png" sizes="128x128" />
  <link rel="stylesheet" href="fonts/font-awesome/css/font-awesome.min.css">
  <style type="text/css">
      .canvas-container{
        width: 75vw !important;
      }
      .minimap{
        right: 27vw !important;
      }
      #usermenu{
        display: none !important;
      }
      .chat-contenedor{
        height: 80.5vh;
      }
      .chat-padding{
        padding-left: 14px!important;
          padding-right: 14px!important;
      }
      .scrollspy-example {
        position: relative;
        height: 70vh;
        overflow-y: auto;
      }
      /*el chat*/
      .mytext{
          border:0;padding:10px;background:whitesmoke;
      }
      .text{
          width:100%;display:flex;flex-direction:column;
      }
      .text > p:first-of-type{
          width:100%;margin-top:0;margin-bottom:auto;line-height: 13px;font-size: 12px;
      }
      .text > p:last-of-type{
         text-align:right;color:silver;margin-bottom:-7px;margin-top:auto;
      }
      .text-l{
          float:left;padding-right:10px;
      }        
      .text-r{
          float:right;padding-left:10px;
      }
      .avatar{
          display:flex;
          justify-content:center;
          align-items:center;
          width:100%;
          float:left;
          padding-right:10px;
      }
      .macro{
          margin-top:5px;width:85%;border-radius:5px;padding:5px;display:flex;
      }
      .msj-rta{
          float:right;background:whitesmoke;
          position: relative;
          right: 20px;
      }
      .msj-rta-dev{
          float: right;
          background: whitesmoke;
          position: relative;
          left: 5px;
          bottom: 5px;
      }
      .msj{
          float:left;background:white;
      }
      .frame{
          background:#e0e0de;
          height:100vh;
          overflow:hidden;
          padding:0;
      }
      .frame > div:last-of-type{
          position:absolute;bottom:0;width:100%;display:flex;
      }
      #span-icon{
          background: whitesmoke;padding: 10px;font-size: 21px;border-radius: 50%;
      }
      body > div > div > div.msj-rta.macro{
          margin:auto;margin-left:1%;
      }
      .flujo-mensaje {
          width:100%;
          list-style-type: none;
          padding:18px;
          position:absolute;
          bottom:32px;
          display:flex;
          flex-direction: column;
          /*top:0;*/
          overflow-y:scroll;
      }
      .msj:before{
          width: 0;
          height: 0;
          content:"";
          top:-5px;
          left:-14px;
          position:relative;
          border-style: solid;
          border-width: 0 13px 13px 0;
          border-color: transparent #ffffff transparent transparent;            
      }
      .msj-rta:after{
          width: 0;
          height: 0;
          content:"";
          top:-0px;
          left:14px;
          position:relative;
          border-style: solid;
          border-width: 13px 13px 0 0;
          border-color: whitesmoke transparent transparent transparent;           
      }  
      input:focus{
          outline: none;
      }        
      ::-webkit-input-placeholder { /* Chrome/Opera/Safari */
          color: #d4d4d4;
      }
      ::-moz-placeholder { /* Firefox 19+ */
          color: #d4d4d4;
      }
      :-ms-input-placeholder { /* IE 10+ */
          color: #d4d4d4;
      }
      :-moz-placeholder { /* Firefox 18- */
          color: #d4d4d4;
      }
      .header-msg{
          /*position: absolute; 
          z-index: 1;*/
          height: 8vh;
      }

      /*hover de alumno*/
      .list-group-item:focus, .list-group-item:hover {
          z-index: 1;
          text-decoration: none;
          background: #00dcffde;
      }
      .chat{
        height: 100vh;
        width: 25vh;
        position: relative;
        left:75vw;
      }
      .row{
        width: 25vw;
      }
      .
  </style>

</head>
<body>
  <div class="app-container">
	<div class="toolbar">
		<div class="notification">Notification</div>
	</div>
  <div class="canvas-container" id="contenedor-diagramador">
    <div class="init-loading"><i class="icon-spin1 animate-spin"></i></div>
    <canvas id="graph" class="canvas" width="3840" height="2400"></canvas>
    <div class="selection"></div>
  </div>
  <div class="chat">
    <div class="row">
        <div class="col-12 scrollspy-example frame" data-spy="scroll" data-target="#spy">
                <ul class="flujo-mensaje" id="contenedor-mensaje"></ul>
                <div class="mx-3 my-0 py-0">
                    <div class="msj-rta-dev macro">                        
                        <div class="text text-r" style="background:whitesmoke !important">
                            <input class="mytext" id="msg" placeholder="Type a message"/>
                        </div> 
                    </div>
                    <div style="padding:10px;">
                        <span id="span-icon" class="fa fa-paper-plane" onclick="chatRealtTime()"></span>
                    </div>                
                </div>
            </div>       
      <!--</div>-->
    </div>
  </div>
	<div class="resizer"></div>
	<div class="sidebar"></div>
	<div style="display: none">
		<img id="cache-image-bg" src="assets/canvas-background-382ddae37df2afda79a647cf643277cc012d079c989b71853f3b9c6f2908c167.png" alt="Canvas background" />
		<img id="cache-image-key" src="assets/key-0f0ed284afcf94f728410e720ca9ac84107d90a676864c780b0a3ddd70d8e58b.png" alt="Key" />
		<img id="cache-image-key-ai" src="assets/key_ai-24ad7604a9cd84fea26fb6d92893079145c7a266d772e7bed9f82814729f524e.png" alt="Key ai" />
		<img id="cache-image-fk" src="assets/table_relationship-50286182fcbd7f9cd9dc4f2b496a9152552d43285cb97dcab3f88f08f16734b2.png" alt="Table relationship" />
		<img id="cache-image-nn" src="assets/notnull-a34e5e8bb4c0ac6157b22a1eb4c4cc75e05b55b62cf81e9814d87dab335aef7e.png" alt="Notnull" />
		<img id="cache-image-ai" src="assets/ai-5ad4475567db2451cc26ce4e7f53c0bd7c07ba5593377ce938eefe47da2c93cc.png" alt="Ai" />
		<img src="dbdesigner_logo_bw.png" id="cache-image-bw-logo" />
	</div>
</div>
<script>
window.userinfo = {
	login: false,
	username: "Guest",
	email: "nobody@dbdesigner.net",
	avatar: "",
	tmpid: "0"
};
window.renv = 'production';
</script>
 <!--  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','../www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-11380314-9', 'auto');
    ga('send', 'pageview');
  </script> -->
</body>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<!-- Mirrored from www.dbdesigner.net/designer?login_guest=true by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 04 Nov 2018 16:35:52 GMT -->
<!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
 --><!-- <script>
  $(document).ready(()=>{
    console.log("Listo para iniciar");
  });
</script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.10/lodash.min.js"></script> -->
<script src="./socket.io/socket.io.js"></script>
<script src="assets/comparacion.js"></script>
<script>
    firebase.auth().onAuthStateChanged((usr) =>{
          if(!usr){
            location.href = "./login";
          }
        });
    var swChange = true;
    function getQueryVariable(variable) {
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0; i < vars.length; i++) {
           var pair = vars[i].split("=");
           if(pair[0] == variable) {
               return pair[1];
           }
       }
       return false;
    }

    function enviarDatos(){
      if(swChange){
        var data = JSON.stringify(app.schema.serialize().tables);
        data = JSON.parse(data);
        var id = getQueryVariable('id');
        data.db = "Nombre bd";
        console.log("subiendo datos a firebase");
        firebase.database().ref().child('salas').child(id).child('tablas').update({tables:data});
      }
    }

    function mergeDatos(local, remoto){
        // var data = Object.assign([],local,remoto)
        // console.log("segundo aqui");
        app.schema.resetSchema();
        app.schema.addTables(remoto);
        setTimeout(()=>{
          swChange = true;
          console.log("listo");
        },1000);
    }

    var id = getQueryVariable('id');
    firebase.database().ref().child('salas').child(id).child('tablas').on('value',snap =>{
      let row = snap.val();
      if( row.tables){
          var dataNew = row.tables;
          var dataOld = JSON.stringify(app.schema.serialize());
          dataOld = JSON.parse(dataOld).tables;
          for( e in dataOld){
              if(!dataOld[e].fields.length){
                  delete dataOld[e].fields
              }
              // }else{
              //   for(i in dataOld[e].fields){
              //     if(!dataOld[e].fields[i].order ){
              //       delete dataOld[e].fields[i].order;
              //     }
              //   }
              // }
              if(!dataOld[e].color){
                  delete dataOld[e].color
              } 
          }
          
          console.log(dataOld);
          console.log(dataNew);
          if(!equals(dataOld, dataNew) && Array.isArray(dataNew)){
              swChange = false;
              mergeDatos(dataOld, dataNew);
              console.log("haciendo cambios");
          }else{
            console.log("esta actualizado");
          }
      }else{
        app.schema.resetSchema();
        console.log("No hay el atributo tables");
      }
    })
</script>
<script>
  
  //trabajando el chat
  var socket = io();
  function enviarMensaje(datos){
    var data = {
      id: getQueryVariable('id'),
      msg: datos,
      uid: firebase.auth().getUid()
    }
    socket.emit('chat message', data);
  }

  socket.on('chat message', function(data){
        //$('#messages').append($('<li>').text(msg));
    //  console.log(msg);
    var id = getQueryVariable('id')
    if( id === data.id){
      insertChat((data.uid === firebase.auth().getUid())? 'you':'her/him', data.msg);
    }
  });

  function formatAMPM(date) {
    var hours = date.getHours();
    var minutes = date.getMinutes();
    var ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; // the hour '0' should be '12'
    minutes = minutes < 10 ? '0'+minutes : minutes;
    var strTime = hours + ':' + minutes + ' ' + ampm;
    return strTime;
}            

//-- No use time. It is a javaScript effect.
function insertChat(who, text){
    var control = "";
    var date = formatAMPM(new Date());
    
    var i = document.createElement('li');
    i.style.width = "100%";
    if (who == "you"){
        control = '<div class="msj-rta macro">' +
                            '<div class="text text-r">' +
                                '<p>'+text+'</p>' +
                                '<p><small>'+date+'</small></p>' +
                   '</div>';
    }else{
        control = '<div class="msj macro">' +
                            '<div class="text text-l">' +
                                '<p>'+ text +'</p>' +
                                '<p><small>'+date+'</small></p>' +
                   '</div>';   
    }
    i.innerHTML = control;
    var e = document.getElementById('contenedor-mensaje');
    e.appendChild(i);


    // setTimeout(
    //     function(){                        
    //         $("#contenedor-mensaje").append(control).scrollTop($("#contenedor-mensaje").prop('scrollHeight'));
    //     }, time);
    
}
function chatRealtTime(){
  var e = document.getElementById('msg');
  var msg = e.value.trim();
  if(msg.length){
    enviarMensaje(msg);
  }
  e.value = "";
}
// function resetChat(){
//     $("#contenedor-mensaje").empty();
// }

</script>
</html>
